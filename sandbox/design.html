<!DOCTYPE html>
<html>
<head>
  <link href="../css/markdown.css" rel="stylesheet">
  <style>
    .editor {
      height: 300px;
    }
    iframe {
      margin: 15px 0;
      border: 0;
      min-height: 600px;
      margin: 15px 0 0 0;
    }
  </style>
</head>
<body class="bg-gray-light">
  
  <div class="row gutter-3">
    <div class="column col-12">
      <div class="box-shadow-2">
        <div class="d-flex col-12 p-3 text-white bg-gray-dark">
          <h1 class="text-uppercase">{{ui.header}}</h1>
          <button class="btn bg-red box-shadow-1 ml-auto mx-1" onclick="clearAll()">{{ui.btn.clear}}</button>
          <button class="btn bg-green box-shadow-1 mx-1" onclick="runEditor()">{{ui.btn.render}}</button>
        </div>
        <div class="bg-white p-3 markdown">
          <div class="row gutter-1">
            <div class="column col-12 lg:col-6">
              <h2 class="text-center">{{ui.title.content}}</h2>
              <div class="editor" id="content">{{content}}</div>
            </div>
            <div class="column col-12 lg:col-6">
              <h2 class="text-center">{{ui.title.design}}</h2>
              <div class="editor" id="design">{{design}}</div>
            </div>
          </div>
          <h2 class="text-center">{{ui.title.preview}}</h2>
          <iframe id="preview" class="col-12"></iframe>
        </div>
      </div>
    </div>
  </div>

  <script src="../js/ace/ace.js"></script>
  <script>
    var editors = {};
    function runEditor(){
      var content, design, preview;
      var content = editors["content"].getValue();
      var design = editors["design"].getValue();
      preview = dcg.render({content: content, design: design});
      document.getElementById('preview').contentWindow.document.open();
      document.getElementById('preview').contentWindow.document.write(preview);
      document.getElementById('preview').contentWindow.document.close();
    }
    function clearAll(){
      editors["content"].setValue("");
      editors["design"].setValue("");
      runEditor();
    }
    function setupEditor(id, mode) {
      trimpre(document.getElementById(id));
      editor = ace.edit(id);
      editor.setTheme("ace/theme/tomorrow_night");
      editor.getSession().setMode(mode);
      editor.setOptions({
        fontSize: "11pt",
        showLineNumbers: true,
        useWorker: false
      });
      editor.setShowPrintMargin(false);
      editor.setBehavioursEnabled(false);
      editors[id] = editor;
      function trimpre(el) {
        var html = el.innerHTML;
        var pattern = html.match(/\s*\n[\t\s]*/);
        el.innerHTML = html.replace(new RegExp(pattern, "g"),'\n').trim();
      }
    }
    setupEditor("content", "ace/mode/html");
    setupEditor("design", "ace/mode/html");
    runEditor();
  </script>
</body>
</html>
